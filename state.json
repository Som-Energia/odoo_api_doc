{
  "openapi": "3.0.0",
  "info": {
    "title": "State Management API",
    "description": "API for retrieving and creating state/province information in Odoo.\n\n## Authentication\nAll endpoints require API key authentication via the `X-API-Key` header.\n\n## Response Format\nAll responses follow a standard format with `success`, `message`, and optionally `data` or `error_code` fields.\n\n## Error Codes\n- `INVALID_API_KEY`: Authentication failed\n- `RECORD_NOT_FOUND`: Resource not found (404 status)\n- `INVALID_PARAMETERS`: Validation error (400 status)\n- `INVALID_FOREIGN_KEY`: Foreign key violation (400 status)\n- `DUPLICATE_KEY_VALUE`: Duplicate resource (409 status)\n- `INTERNAL_SERVER_ERROR`: Unexpected error (500 status)\n",
    "version": "1.0.0",
    "contact": {
      "name": "Punt Sistemes"
    }
  },
  "servers": [
    {
      "url": "{protocol}://{host}:{port}{basePath}",
      "description": "Personalized Server Configuration",
      "variables": {
        "protocol": {
          "enum": [
            "http",
            "https"
          ],
          "default": "http",
          "description": "Protocol (http or https)"
        },
        "host": {
          "default": "localhost",
          "description": "Server hostname or IP address"
        },
        "port": {
          "default": "8069",
          "description": "Server port number"
        },
        "basePath": {
          "default": "/api/v1",
          "description": "API base path"
        }
      }
    }
  ],
  "security": [
    {
      "ApiKeyAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "API key for authentication"
      }
    }
  },
  "paths": {
    "/state/{code_country}/{code}": {
      "get": {
        "summary": "Get State",
        "description": "Retrieve a specific state/province by country code and state code.\n\nThe endpoint searches for a case-insensitive match of the sanitized state code\nwithin the specified country. Returns 404 if no matching record exists.\n",
        "operationId": "get_state",
        "tags": [
          "States"
        ],
        "parameters": [
          {
            "name": "code_country",
            "in": "path",
            "required": true,
            "description": "The country code (e.g., 'ES', 'FR')",
            "schema": {
              "type": "string",
              "example": "ES"
            }
          },
          {
            "name": "code",
            "in": "path",
            "required": true,
            "description": "The state/province code to search for",
            "schema": {
              "type": "string",
              "example": "V"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "State found successfully",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "message": "Record found successfully",
                  "data": {
                    "odoo_id": 1,
                    "erp_id": 10001,
                    "name": "Valencia"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid, missing, or expired API key",
            "content": {
              "application/json": {
                "example": {
                  "success": false,
                  "error_code": "INVALID_API_KEY",
                  "message": "Invalid or missing API key"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - The state with this code does not exist",
            "content": {
              "application/json": {
                "example": {
                  "success": false,
                  "error_code": "RECORD_NOT_FOUND",
                  "message": "Record not found: ES - V"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error - Unexpected error occurred",
            "content": {
              "application/json": {
                "example": {
                  "success": false,
                  "error_code": "INTERNAL_SERVER_ERROR",
                  "message": "An internal server error occurred"
                }
              }
            }
          }
        }
      }
    },
    "/states": {
      "post": {
        "summary": "Create State",
        "description": "Create a new state/province record.\n\nThe endpoint validates the input data and creates a new state record.\nReturns 409 if a duplicate state already exists.\n",
        "operationId": "create_state",
        "tags": [
          "States"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "name": "Valencia",
                "code": "V",
                "country_id": 68,
                "pnt_erp_id": 10001
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "State created successfully",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "message": "Record created successfully",
                  "data": {
                    "odoo_id": 1,
                    "erp_id": 10001,
                    "values": {
                      "name": "Valencia",
                      "code": "V",
                      "country_id": 68,
                      "pnt_erp_id": 10001
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input parameters or foreign key violation.\nThis error occurs when:\n- Required fields are missing or empty\n- Field values don't meet validation rules\n- The country_id does not exist\n",
            "content": {
              "application/json": {
                "examples": {
                  "validation_error": {
                    "summary": "Validation error for empty field",
                    "value": {
                      "success": false,
                      "error_code": "INVALID_PARAMETERS",
                      "message": "Validation error in request parameters",
                      "validation_errors": [
                        {
                          "type": "value_error",
                          "loc": [
                            "name"
                          ],
                          "msg": "String should have at least 1 character",
                          "input": ""
                        }
                      ]
                    }
                  },
                  "foreign_key_error": {
                    "summary": "Invalid country reference",
                    "value": {
                      "success": false,
                      "error_code": "INVALID_FOREIGN_KEY",
                      "message": "Invalid foreign key reference"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid, missing, or expired API key",
            "content": {
              "application/json": {
                "example": {
                  "success": false,
                  "error_code": "INVALID_API_KEY",
                  "message": "Invalid or missing API key"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - A state with this code already exists for this country",
            "content": {
              "application/json": {
                "example": {
                  "success": false,
                  "error_code": "DUPLICATE_KEY_VALUE",
                  "message": "Record with provided key already exists: duplicate key value violates unique constraint"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error - Unexpected error occurred",
            "content": {
              "application/json": {
                "example": {
                  "success": false,
                  "error_code": "INTERNAL_SERVER_ERROR",
                  "message": "An internal server error occurred"
                }
              }
            }
          }
        }
      }
    }
  }
}
